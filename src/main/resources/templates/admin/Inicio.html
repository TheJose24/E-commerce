<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="/css/admin/productos/dashboard.css">
    <title>Slam Admin | Dashboard</title>
    <style>
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }

        .stats-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
<main class="container-fluid">
    <div class="row">
        <div th:insert="~{admin/components/menuLateral.html::sidebar}"></div>
        <div class="content-area">
            <div class="row mb-4">
                <div class="col-md-12">
                    <h2 class="mb-4">Dashboard</h2>
                </div>
            </div>

            <!-- Tarjetas de Estadísticas -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="stats-card bg-primary text-white">
                        <h3>Total Pedidos</h3>
                        <h4 th:text="${#maps.size(pedidosPorMes)}">0</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card bg-success text-white">
                        <h3>Total Productos</h3>
                        <h4 th:text="${#maps.size(productosPorCategoria)}">0</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card bg-info text-white">
                        <h3>Total Usuarios</h3>
                        <h4 th:text="${#lists.size(usuariosStats)}">0</h4>
                    </div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="row">
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4>Pedidos por Mes</h4>
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h4>Productos por Categoría</h4>
                        <div class="chart-container">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="dashboard-card">
                        <h4>Actividad de Usuarios</h4>
                        <div class="chart-container">
                            <canvas id="scatterChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    // Datos del servidor
    const pedidosPorMes = /*[[${pedidosPorMes}]]*/ {};
    const productosPorCategoria = /*[[${productosPorCategoria}]]*/ {};
    const usuariosStats = /*[[${usuariosStats}]]*/ [];

    // Configuración común de los gráficos
    Chart.defaults.font.family = "'Arial', sans-serif";
    Chart.defaults.font.size = 12;

    // Gráfico de Barras
    const ctxBar = document.getElementById('barChart').getContext('2d');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: Object.keys(pedidosPorMes),
            datasets: [{
                label: 'Pedidos por Mes',
                data: Object.values(pedidosPorMes),
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: false
                }
            }
        }
    });

    // Gráfico Circular
    const ctxPie = document.getElementById('pieChart').getContext('2d');
    new Chart(ctxPie, {
        type: 'doughnut',
        data: {
            labels: Object.keys(productosPorCategoria),
            datasets: [{
                data: Object.values(productosPorCategoria),
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right'
                }
            }
        }
    });

    // Gráfico de Dispersión
    const ctxScatter = document.getElementById('scatterChart').getContext('2d');
    new Chart(ctxScatter, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Pedidos por Usuario',
                data: usuariosStats.map(user => ({
                    x: user.id,
                    y: user.cantidadPedidos
                })),
                backgroundColor: 'rgba(75, 192, 192, 0.7)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                pointRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return `Usuario ID: ${context.parsed.x}, Pedidos: ${context.parsed.y}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'ID Usuario'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Cantidad de Pedidos'
                    }
                }
            }
        }
    });
</script>
</body>

</html>